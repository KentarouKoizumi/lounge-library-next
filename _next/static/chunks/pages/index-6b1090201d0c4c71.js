(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(3424)}])},3424:function(e,n,t){"use strict";t.r(n),t.d(n,{IsPostingNowContext:function(){return K},LendingListContext:function(){return Q},StudentIdContext:function(){return J},default:function(){return U}});var s=t(7568),r=t(655),i=t(5893),a=t(7294),o=t(6336),c=t(9144),l=t(918),d=t(1953),u=t(2722),h=t(8661),x=t(9630),j=t(5084),g=t(9994),Z=t(4821),m=t(1927),f=t(196),v=t(7320),p=t(6070),b=t(5902),C=t(9243),I=t(4065),S=t(9618),k=t(7028),w=t(1170),F=t(6395),_=t(3508),N=t(4970),y=t.n(N);function P(){var e,n=(0,a.useState)(null),t=n[0],o=n[1],l=(0,a.useState)(""),u=l[0],h=l[1],g=(0,a.useState)(!1),Z=g[0],m=g[1],N=(0,a.useState)({status:"recognizing text",progress:1}),P=N[0],z=N[1],D=(0,a.useState)(""),L=D[0],B=D[1],E=(0,a.useRef)(null),O=(0,a.useState)(!1),H=O[0],T=O[1],W=(0,a.useState)(""),A=W[0],M=W[1],Y=(0,a.useState)([""]),V=Y[0],q=Y[1],X=(0,a.useState)(""),$=X[0],G=X[1],R=(0,a.useContext)(J),Q=R.studentId,U=R.setStudentId,ee=R.isStudentIdValid,en=R.studentIdOnChangeHandler,et=(0,a.useContext)(K),es=et.isPostingNow,er=et.setIsPostingNow,ei=(0,a.useState)({open:!1,message:""}),ea=ei[0],eo=ei[1],ec=(0,a.useCallback)(function(){var e,n=null===(e=E.current)||void 0===e?void 0:e.getScreenshot();null!=n&&(o(n),eu(n))},[E]),el=function(){o(null)},ed=(0,v.createWorker)({logger:function(e){z({status:e.status,progress:e.progress})}}),eu=(e=(0,s.Z)(function(e){var n,t,s,i;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return[4,ed.load()];case 1:return n.sent(),[4,ed.loadLanguage("eng")];case 2:return n.sent(),[4,ed.initialize("eng")];case 3:return n.sent(),[4,ed.recognize(e)];case 4:return B(t=n.sent().data.text),(s=t.match(/(I|1|\[|\])(S|5|s)(B|8|5)N[0-9 -]{9,18}/))&&h(s[0].toString().slice(4).replaceAll("-","").replaceAll(" ","")),[2]}})}),function(n){return e.apply(this,arguments)}),eh=function(){m(!Z)};(0,a.useEffect)(function(){(9===u.length||10===u.length||13===u.length)&&f.ZP.get("https://www.googleapis.com/books/v1/volumes?q=isbn:"+u).then(function(e){e.data.totalItems>0?(e.data.items[0].volumeInfo.subtitle?M(e.data.items[0].volumeInfo.title+" "+e.data.items[0].volumeInfo.subtitle):M(e.data.items[0].volumeInfo.title),e.data.items[0].volumeInfo.authors?q(e.data.items[0].volumeInfo.authors):q(["著者未定義"]),T(!0)):(M(""),q([""]),T(!1))})},[u]);var ex,ej=function(e){h(e.target.value)},eg=(ex=(0,s.Z)(function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return er(!0),[4,f.ZP.post("/api/postNewLending",{bookIsbn:u,bookAuthors:V,bookTitle:A,studentId:Q}).then(function(e){h(""),U(""),er(!1),T(!1),G(""),eo({open:!0,message:"貸出しました：".concat(A)})}).catch(function(e){G(e.request.response),er(!1)})];case 1:return e.sent(),[2]}})}),function(){return ex.apply(this,arguments)});return(0,i.jsxs)(i.Fragment,{children:[Z?(0,i.jsx)(i.Fragment,{children:null==t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{sx:{width:"30em",maxWidth:"100%",maxHeight:"100%",mx:"auto"},children:(0,i.jsx)(y(),{audio:!1,ref:E,forceScreenshotSourceSize:!0,screenshotFormat:"image/jpeg",width:"100%",videoConstraints:{width:1920,height:1080,facingMode:"environment"}})}),(0,i.jsx)(d.Z,{sx:{height:5}}),(0,i.jsx)(d.Z,{display:"flex",justifyContent:"center",alignItems:"center",children:(0,i.jsxs)(c.Z,{spacing:2,direction:"row",children:[(0,i.jsxs)(j.Z,{onClick:ec,variant:"contained",children:[(0,i.jsx)(w.Z,{sx:{mr:1}}),"文字を読み取る"]}),(0,i.jsxs)(j.Z,{onClick:eh,variant:"outlined",children:[(0,i.jsx)(F.Z,{sx:{mr:1}}),"カメラをきる"]})]})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{sx:{width:"30em",maxWidth:"100%",maxHeight:"100%",mx:"auto"},children:(0,i.jsx)("img",{src:t,style:{maxWidth:"100%",maxHeight:"100%"}})}),(0,i.jsx)(d.Z,{sx:{height:5}}),(0,i.jsx)(d.Z,{display:"flex",justifyContent:"center",alignItems:"center",children:(0,i.jsxs)(c.Z,{spacing:2,direction:"row",children:[(0,i.jsxs)(j.Z,{onClick:el,variant:"contained",children:[(0,i.jsx)(w.Z,{sx:{mr:1}}),"リトライ"]}),(0,i.jsxs)(j.Z,{onClick:eh,variant:"outlined",children:[(0,i.jsx)(F.Z,{sx:{mr:1}}),"カメラをきる"]})]})})]})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.Z,{display:"flex",justifyContent:"center",alignItems:"center",children:(0,i.jsxs)(j.Z,{onClick:eh,variant:"contained",children:[(0,i.jsx)(w.Z,{sx:{mr:1}}),"ISBN をカメラで読み取る"]})})}),!(1===P.progress&&"recognizing text"===P.status)&&(0,i.jsxs)(d.Z,{sx:{width:"100%"},children:[(0,i.jsx)(x.Z,{children:P.status}),(0,i.jsx)(p.Z,{variant:"determinate",value:100*P.progress})]}),""!=L&&(0,i.jsxs)(I.Z,{sx:{my:2,backgroundColor:"#f0f0f0"},children:[(0,i.jsx)(S.Z,{expandIcon:(0,i.jsx)(_.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,i.jsx)(x.Z,{children:"読み取られた文字を表示"})}),(0,i.jsx)(k.Z,{children:(0,i.jsx)(x.Z,{children:L})})]}),(0,i.jsx)(d.Z,{sx:{height:20}}),(0,i.jsx)(x.Z,{variant:"h6",children:"借りる方法"}),(0,i.jsx)(x.Z,{children:"学籍番号とISBNを入力して借りるボタンを押してください"}),(0,i.jsx)(x.Z,{children:"※ ISBNはカメラで読み取ることもできます"}),(0,i.jsx)(x.Z,{children:"※ ISBNは半角数字（ハイフンなし）で入力（例 : 9784150110000）"}),(0,i.jsx)(x.Z,{children:"※ 学籍番号は半角英数字，小文字で入力（例 : 22s2099x）"}),(0,i.jsx)(d.Z,{sx:{height:20}}),(0,i.jsxs)(c.Z,{spacing:2,direction:"column",children:[(0,i.jsx)(b.Z,{value:u,label:"ISBN",onChange:ej,error:0!==u.length&&!H}),(0,i.jsx)(b.Z,{value:Q,label:"学籍番号",onChange:en,error:0!==Q.length&&!ee}),H?(0,i.jsx)(x.Z,{children:""!=A&&V+"「"+A+"」"}):(0,i.jsx)(i.Fragment,{}),(0,i.jsx)(j.Z,{variant:"contained",onClick:eg,disabled:es||!H||!ee,children:"借りる"})]}),(0,i.jsx)(C.Z,{open:ea.open,anchorOrigin:{vertical:"bottom",horizontal:"center"},autoHideDuration:6e3,message:ea.message,onClose:function(){return eo({open:!1,message:""})}}),es?(0,i.jsx)(p.Z,{}):(0,i.jsx)(i.Fragment,{}),""!==$?(0,i.jsx)(x.Z,{color:"error",children:$}):(0,i.jsx)(i.Fragment,{})]})}var z=t(4924),D=t(6042),L=t(9396),B=t(6777),E=t(244),O=t(3978),H=t(9417),T=t(5605),W=t(9807),A=t(1362),M=t(7484),Y=t.n(M);function V(){var e,n=(0,a.useContext)(J),t=n.studentId,o=n.isStudentIdValid,c=n.studentIdOnChangeHandler,l=(0,a.useContext)(Q).lendingList,u=(0,a.useContext)(K),h=u.isPostingNow,g=u.setIsPostingNow,Z=(0,a.useState)({}),m=Z[0],v=Z[1],I=(0,a.useState)({open:!1,message:""}),S=I[0],k=I[1];(0,a.useEffect)(function(){var e=l.filter(function(e){return e.studentId===t}),n={};e.forEach(function(e){n[e.id]=!1}),v(n)},[t,l]);var w=(e=(0,s.Z)(function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e=Object.keys(m).filter(function(e){return m[e]}),g(!0),[4,f.ZP.post("/api/returnBooks",{ids:e}).then(function(n){g(!1),k({open:!0,message:"".concat(e.length,"冊返却しました")})}).catch(function(e){g(!1)})];case 1:return n.sent(),[2]}})}),function(){return e.apply(this,arguments)}),F=function(e){var n=e.target.name;v((0,L.Z)((0,D.Z)({},m),(0,z.Z)({},n,e.target.checked)))};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{variant:"h6",children:"返却方法"}),(0,i.jsx)(x.Z,{children:"１．学籍番号を入力"}),(0,i.jsx)(x.Z,{children:"２．返却する書籍を選択"}),(0,i.jsx)(x.Z,{children:"３．返却ボタンを押す"}),(0,i.jsx)(x.Z,{children:"※ 返却済みの書籍を選択すると返却を取り消せます"}),(0,i.jsx)(d.Z,{sx:{height:20}}),(0,i.jsx)(b.Z,{value:t,label:"学籍番号",onChange:c,error:0!==t.length&&!o}),h?(0,i.jsx)(p.Z,{}):(0,i.jsx)(i.Fragment,{}),o?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(B.Z,{children:(0,i.jsxs)(E.Z,{sx:{minWidth:650},"aria-label":"simple table",children:[(0,i.jsx)(O.Z,{children:(0,i.jsxs)(H.Z,{children:[(0,i.jsx)(T.Z,{children:"返却"}),(0,i.jsx)(T.Z,{children:"貸出状況"}),(0,i.jsx)(T.Z,{children:"貸出日"}),(0,i.jsx)(T.Z,{children:"タイトル"}),(0,i.jsx)(T.Z,{children:"著者"})]})}),(0,i.jsx)(W.Z,{children:l.map(function(e){return(0,i.jsx)(i.Fragment,{children:e.studentId===t&&(0,i.jsxs)(H.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,i.jsx)(T.Z,{children:(0,i.jsx)(A.Z,{name:e.id,checked:void 0!==m[e.id]&&m[e.id],onChange:F})}),(0,i.jsx)(T.Z,{children:Y().unix(e.lendingDatetime/1e3).format("YY/MM/DD")}),(0,i.jsx)(T.Z,{children:e.bookTitle}),(0,i.jsx)(T.Z,{children:e.bookAuthors.join(", ")})]},e.id)})})})]})}),(0,i.jsx)(d.Z,{sx:{height:30}}),(0,i.jsx)(j.Z,{variant:"contained",onClick:w,disabled:h||!o||0===Object.keys(m).filter(function(e){return m[e]}).length,children:"返却"}),(0,i.jsx)(C.Z,{open:S.open,message:S.message,anchorOrigin:{vertical:"bottom",horizontal:"center"},autoHideDuration:6e3,onClose:function(){return k({open:!1,message:""})}})]}):(0,i.jsx)(i.Fragment,{})]})}function q(){var e=(0,a.useContext)(Q).lendingList;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{variant:"h5",component:"h2",gutterBottom:!0,sx:{textDecoration:"underline"},children:"貸し出されている書籍"}),0!==e.length?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(B.Z,{children:(0,i.jsxs)(E.Z,{sx:{minWidth:650},"aria-label":"simple table",children:[(0,i.jsx)(O.Z,{children:(0,i.jsxs)(H.Z,{children:[(0,i.jsx)(T.Z,{children:"貸出日"}),(0,i.jsx)(T.Z,{children:"学籍番号"}),(0,i.jsx)(T.Z,{children:"タイトル"}),(0,i.jsx)(T.Z,{children:"著者"})]})}),(0,i.jsx)(W.Z,{children:e.map(function(e){return(0,i.jsxs)(H.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,i.jsx)(T.Z,{children:Y().unix(e.lendingDatetime/1e3).format("YY/MM/DD")}),(0,i.jsx)(T.Z,{children:e.studentId}),(0,i.jsx)(T.Z,{children:e.bookTitle}),(0,i.jsx)(T.Z,{children:e.bookAuthors.join(", ")})]},e.id)})})]})})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{children:"貸出情報を読込中"}),(0,i.jsx)(p.Z,{})]})]})}var X=t(5050),$=t(784);function G(){var e,n;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.Z,{sx:{flexGrow:1,paddingTop:1,paddingBottom:1},children:(0,i.jsx)(X.Z,{position:"static",sx:{background:"linear-gradient(".concat(90,"deg, ").concat("#004d40"," 0%, ").concat("#009688"," 100%)")},children:(0,i.jsx)($.Z,{children:(0,i.jsx)(x.Z,{variant:"h5",component:"h1",children:"ラウンジ6F貸出管理システム"})})})})})}var R=(0,Z.Z)({palette:{primary:{light:"#00695C",main:"#00695C",dark:"#00695C",contrastText:"#fff"},secondary:{light:"#ff7961",main:"#f44336",dark:"#ba000d",contrastText:"#000"}}}),J=(0,a.createContext)({}),K=(0,a.createContext)({}),Q=(0,a.createContext)({}),U=function(){var e,n=(0,a.useState)(""),t=n[0],Z=n[1],v=(0,a.useState)([]),p=v[0],b=v[1],C=(0,a.useState)(!1),I=C[0],S=C[1],k=(0,a.useState)(!1),w=k[0],F=k[1],_=(0,a.useState)(0),N=_[0],y=_[1],z=(e=(0,s.Z)(function(){var e,n;return(0,r.__generator)(this,function(e){switch(e.label){case 0:return[4,f.ZP.get("/api/getLendingList",{})];case 1:return(n=e.sent().data).sort(function(e,n){return e.lendingDatetime>n.lendingDatetime?-1:1}),b(n),[2]}})}),function(){return e.apply(this,arguments)}),D=function(e){Z(e.target.value)};(0,a.useEffect)(function(){var e=t.match(/^[0-9]{2}[a-z]{1}[0-9]{4}[a-z]{1}$/),n=t.match(/^[0-9]{2}[a-z]{2}[0-9]{3}[a-z]{1}$/);e||n?F(!0):F(!1)},[t]),(0,a.useEffect)(function(){z()},[I]);var L=function(e,n){y(n)};return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(m.Z,{theme:R,children:(0,i.jsx)(Q.Provider,{value:{lendingList:p,setLendingList:b},children:(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(G,{}),(0,i.jsxs)(c.Z,{spacing:2,children:[(0,i.jsxs)(l.Z,{elevation:3,children:[(0,i.jsx)(d.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,i.jsxs)(u.Z,{value:N,onChange:L,variant:"fullWidth",children:[(0,i.jsx)(h.Z,{label:(0,i.jsx)(x.Z,{variant:"h6",children:"貸出"}),id:"tab-rent"}),(0,i.jsx)(h.Z,{label:(0,i.jsx)(x.Z,{variant:"h6",children:"返却"}),id:"tab-return"})]})}),(0,i.jsx)(d.Z,{sx:{p:3},children:(0,i.jsx)(J.Provider,{value:{studentId:t,setStudentId:Z,isStudentIdValid:w,studentIdOnChangeHandler:D},children:(0,i.jsxs)(K.Provider,{value:{isPostingNow:I,setIsPostingNow:S},children:[0===N&&(0,i.jsx)(P,{}),1===N&&(0,i.jsx)(V,{})]})})})]}),(0,i.jsxs)(l.Z,{elevation:3,sx:{p:3},children:[(0,i.jsx)(q,{}),(0,i.jsxs)(j.Z,{onClick:z,children:[(0,i.jsx)(g.Z,{sx:{mr:1}}),"更新する"]})]})]})]})})})})}}},function(e){e.O(0,[618,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);